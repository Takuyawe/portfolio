---
import Layout from '../layouts/Layout.astro'
import Home from '../components/Home.astro'
import About from '../components/About.astro'
import Skills from '../components/Skills.astro'
import Projects from '../components/Projects.astro'
import Contact from '../components/Contact.astro'
---

<Layout title="Welcome to My Porfolio">
  <!-- TODO: IDによって表示するコンポーネントを -->
  <Home />
  <About />
  <Skills />
  <Projects />
  <!-- <ProjectOne /> -->
  <!-- <ProjectTwo /> -->
  <Contact />
</Layout>
<script>
  import { currentPageId } from '../stores/pageId'
  import { getViewSectionId } from '../modules'

  // let lastScrollPosition = window.scrollY || document.documentElement.scrollTop;

  let isScrollable = true

  window.addEventListener('wheel', async (e) => {
    if (!isScrollable) return
    isScrollable = false
    let nextPageId = currentPageId.get()
    if (e.deltaY > 0) {
      if (nextPageId === 4) {
        nextPageId = 0
      } else {
        nextPageId++
      }
    } else if (e.deltaY < 0) {
      if (nextPageId === 0) {
        nextPageId = 4
      } else {
        nextPageId--
      }
    }
    const sectionId = getViewSectionId(nextPageId)
    currentPageId.set(nextPageId)
    document.getElementById(sectionId)?.scrollIntoView({ behavior: 'smooth' })
    await new Promise((resolve) => setTimeout(resolve, 1000))
    isScrollable = true
  })

  // TODO: mousewheelでのスクロールに対応させる
  window.addEventListener('keydown', (e) => {
    let nextPageId = currentPageId.get()
    // const currentScrollPosition =
    //   window.scrollY || document.documentElement.scrollTop;
    if (e.key === 'ArrowDown') {
      console.log('down')
      if (nextPageId === 4) {
        nextPageId = 0
      } else {
        nextPageId++
      }
    } else if (e.key === 'ArrowUp') {
      console.log('up')
      if (nextPageId === 0) {
        nextPageId = 4
      } else {
        nextPageId--
      }
    }
    const sectionId = getViewSectionId(nextPageId)
    currentPageId.set(nextPageId)
    document.getElementById(sectionId)?.scrollIntoView({ behavior: 'smooth' })
  })
</script>
